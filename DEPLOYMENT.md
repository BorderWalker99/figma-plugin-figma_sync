# ScreenSync éƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æœ€å¸¸ç”¨å‘½ä»¤ï¼ˆ99% çš„æƒ…å†µï¼‰

```bash
./release.sh
```

å°±è¿™ä¸€ä¸ªå‘½ä»¤ï¼ç”¨æˆ·ä¼šåœ¨ 1 å°æ—¶å†…è‡ªåŠ¨æ”¶åˆ°æ›´æ–°ã€‚

### è„šæœ¬ä¾èµ–å…³ç³»

```
release.shï¼ˆä¸€é”®å‘å¸ƒè„šæœ¬ï¼‰
    â”‚
    â”œâ”€ è°ƒç”¨ package-for-update.sh
    â”‚     â””â”€ æ‰“åŒ…æ’ä»¶ â†’ figma-plugin-v1.0.1.zip
    â”‚
    â””â”€ è°ƒç”¨ package-for-distribution.sh
          â””â”€ æ‰“åŒ…æœåŠ¡å™¨ â†’ ScreenSync-UserPackage.tar.gz
```

**é‡è¦**ï¼šä¸è¦åˆ é™¤ `package-for-update.sh` å’Œ `package-for-distribution.sh`ï¼Œå®ƒä»¬æ˜¯ `release.sh` çš„æ ¸å¿ƒä¾èµ–ï¼

---

## ğŸ“ æ–‡ä»¶ä¿®æ”¹å¯¹ç…§è¡¨

### âœ… åªéœ€è¿è¡Œ `./release.sh` çš„æ–‡ä»¶

| æ–‡ä»¶/ç›®å½• | è¯´æ˜ | æ›´æ–°æ–¹å¼ |
|----------|------|---------|
| `figma-plugin/ui.html` | æ’ä»¶ç•Œé¢ | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `figma-plugin/code.js` | æ’ä»¶é€»è¾‘ | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `figma-plugin/manifest.json` | æ’ä»¶é…ç½® | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `server.js` çš„ WebSocket éƒ¨åˆ† | å®æ—¶é€šä¿¡ï¼ˆ1-1300 è¡Œï¼‰ | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `server.js` çš„æ›´æ–°æ£€æµ‹éƒ¨åˆ† | è‡ªåŠ¨æ›´æ–°é€»è¾‘ï¼ˆ2200+ è¡Œï¼‰ | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `drive-watcher.js` | Google Drive ç›‘å¬ | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `icloud-watcher.js` | iCloud ç›‘å¬ | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `aliyun-watcher.js` | é˜¿é‡Œäº‘ç›‘å¬ | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `googleDrive.js` | Google Drive API | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `aliyunOSS.js` | é˜¿é‡Œäº‘ OSS API | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `userConfig.js` | ç”¨æˆ·é…ç½®ç®¡ç† | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `update-manager.js` | æ›´æ–°ç®¡ç†å™¨ | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `start.js` | æœåŠ¡å™¨å¯åŠ¨è„šæœ¬ | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `package.json` | ä¾èµ–é…ç½® | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `installer/*` | GUI å®‰è£…å™¨ | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |
| `com.screensync.server.plist` | LaunchAgent é…ç½® | ç”¨æˆ·è‡ªåŠ¨æ›´æ–° |

**éƒ¨ç½²å‘½ä»¤**ï¼š
```bash
./release.sh
```

---

### âš ï¸ éœ€è¦è¿è¡Œ `./release.sh` + `./deploy-cloud-run.sh` çš„æ–‡ä»¶

| æ–‡ä»¶ | å…·ä½“ä½ç½® | è¯´æ˜ |
|-----|---------|------|
| `server.js` | ç¬¬ 1259-1343 è¡Œ | `app.post('/upload-oss')` |
| `server.js` | ç¬¬ 1348-1468 è¡Œ | `app.post('/upload')` |
| `server.js` | ç¬¬ 1473-1550 è¡Œ | `app.post('/upload-url')` |
| `Dockerfile` | å…¨éƒ¨ | Docker é•œåƒé…ç½® |

**éƒ¨ç½²å‘½ä»¤**ï¼š
```bash
# æ­¥éª¤ 1ï¼šå‘å¸ƒåˆ° GitHubï¼ˆç”¨æˆ·ç«¯æ›´æ–°ï¼‰
./release.sh

# æ­¥éª¤ 2ï¼šéƒ¨ç½²åˆ° Cloud Runï¼ˆäº‘ç«¯æ›´æ–°ï¼‰
./deploy-cloud-run.sh
```

---

## ğŸ¯ å¿«é€Ÿåˆ¤æ–­

### æ–¹æ³• 1ï¼šçœ‹æ–‡ä»¶å

```
ä¿®æ”¹äº†è¿™äº›æ–‡ä»¶ï¼Ÿåªéœ€ ./release.sh
â”œâ”€ figma-plugin/ ä¸‹çš„ä»»ä½•æ–‡ä»¶
â”œâ”€ *-watcher.js
â”œâ”€ googleDrive.js
â”œâ”€ aliyunOSS.js
â”œâ”€ userConfig.js
â”œâ”€ update-manager.js
â”œâ”€ start.js
â”œâ”€ installer/ ä¸‹çš„ä»»ä½•æ–‡ä»¶
â””â”€ package.json

ä¿®æ”¹äº†è¿™äº›ï¼Ÿéœ€è¦ ./release.sh + ./deploy-cloud-run.sh
â”œâ”€ server.js çš„ app.post('/upload*') éƒ¨åˆ†
â””â”€ Dockerfile
```

### æ–¹æ³• 2ï¼šçœ‹ä»£ç è¡Œå·

å¦‚æœä½ ä¿®æ”¹çš„æ˜¯ `server.js`ï¼Œæ£€æŸ¥è¡Œå·ï¼š

```bash
# æŸ¥çœ‹ä½ ä¿®æ”¹çš„å…·ä½“ä½ç½®
git diff server.js

# å¦‚æœè¡Œå·åœ¨ä»¥ä¸‹èŒƒå›´å†…ï¼Œéœ€è¦éƒ¨ç½² Cloud Runï¼š
# - 1259-1343 è¡Œ (upload-oss)
# - 1348-1468 è¡Œ (upload)
# - 1473-1550 è¡Œ (upload-url)
```

### æ–¹æ³• 3ï¼šä¸ç¡®å®šæ—¶

**å…ˆåªè¿è¡Œ `./release.sh`ï¼Œè§‚å¯Ÿç”¨æˆ·åé¦ˆã€‚**

å¦‚æœç”¨æˆ·åé¦ˆ iPhone å¿«æ·æŒ‡ä»¤ä¸Šä¼ å¤±è´¥ï¼Œå†è¿è¡Œ `./deploy-cloud-run.sh`ã€‚

---

## ğŸ“‹ å®Œæ•´éƒ¨ç½²æµç¨‹

### ç¬¬ 0 æ­¥ï¼šé¦–æ¬¡å‘å¸ƒå‰å‡†å¤‡ï¼ˆä»…é¦–æ¬¡éœ€è¦ï¼‰

**å¦‚æœè¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡å‘å¸ƒï¼Œéœ€è¦å…ˆæ„å»º GUI å®‰è£…å™¨**ï¼š

```bash
cd installer
npm install
npm run build
cd ..
```

æ„å»ºæˆåŠŸåä¼šç”Ÿæˆï¼š
- `installer/dist/mac-arm64/ScreenSync Installer.app`ï¼ˆApple Siliconï¼‰
- æˆ– `installer/dist/mac/ScreenSync Installer.app`ï¼ˆIntelï¼‰

**ä¹‹åçš„æ¯æ¬¡å‘å¸ƒéƒ½ä¸éœ€è¦é‡æ–°æ„å»ºï¼Œé™¤éä½ ä¿®æ”¹äº† installer ä»£ç ã€‚**

### ç¬¬ 1 æ­¥ï¼šæ›´æ–°ç‰ˆæœ¬å·å’Œä»£ç 

```bash
# 1. ä¿®æ”¹ä»£ç 
vim figma-plugin/ui.html
vim server.js

# 2. æœ¬åœ°æµ‹è¯•
npm start
# åœ¨ Figma ä¸­æµ‹è¯•æ’ä»¶åŠŸèƒ½
```

### ç¬¬ 2 æ­¥ï¼šå‘å¸ƒåˆ° GitHub

```bash
./release.sh
```

æŒ‰æç¤ºè¾“å…¥ï¼š
- **æ–°ç‰ˆæœ¬å·**ï¼ˆå¦‚ `1.0.1`ï¼‰
  - Bug ä¿®å¤ï¼š`1.0.0` â†’ `1.0.1`
  - æ–°å¢åŠŸèƒ½ï¼š`1.0.1` â†’ `1.1.0`
  - é‡å¤§æ›´æ–°ï¼š`1.1.0` â†’ `2.0.0`
- **æ›´æ–°è¯´æ˜**ï¼ˆå¦‚ "ä¿®å¤ GIF å¯¼å…¥é—®é¢˜"ï¼‰

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. âœ… æ›´æ–° `figma-plugin/code.js` ç‰ˆæœ¬å·
2. âœ… æ›´æ–° `VERSION.txt` ç‰ˆæœ¬å·
3. âœ… æ‰“åŒ…æ’ä»¶ï¼ˆ`figma-plugin-v1.0.1.zip`ï¼‰
4. âœ… æ‰“åŒ…æœåŠ¡å™¨ï¼ˆ`ScreenSync-UserPackage.tar.gz`ï¼‰
5. âœ… æäº¤ä»£ç åˆ° GitHub
6. âœ… åˆ›å»º Git Tagï¼ˆ`v1.0.1`ï¼‰
7. âœ… å‘å¸ƒåˆ° GitHub Releases

### ç¬¬ 3 æ­¥ï¼šï¼ˆå¯é€‰ï¼‰éƒ¨ç½² Cloud Run

**ä»…å½“ä¿®æ”¹äº† HTTP ä¸Šä¼ ç«¯ç‚¹æ—¶**ï¼š

```bash
./deploy-cloud-run.sh
```

ç­‰å¾… 5-10 åˆ†é’Ÿå®Œæˆéƒ¨ç½²ã€‚

---

## â± ç”¨æˆ·æ”¶åˆ°æ›´æ–°çš„æ—¶é—´

```
ä½ è¿è¡Œ ./release.sh
    â†“
    ç«‹å³ï¼šRelease å‘å¸ƒåˆ° GitHub
    â†“
    0-60 åˆ†é’Ÿï¼šç”¨æˆ·æ’ä»¶è‡ªåŠ¨æ£€æµ‹åˆ°æ›´æ–°
    â†“
    ç”¨æˆ·ç‚¹å‡»ã€Œç«‹å³æ›´æ–°ã€
    â†“
    2-5 åˆ†é’Ÿï¼šè‡ªåŠ¨ä¸‹è½½å®‰è£…
    â†“
    âœ… æ›´æ–°å®Œæˆ
```

**æœ€å¿«**ï¼šç”¨æˆ·é‡å¯æ’ä»¶ï¼Œç«‹å³æ£€æµ‹åˆ°ï¼ˆ0 åˆ†é’Ÿï¼‰
**æœ€æ…¢**ï¼šæ’ä»¶ä¸€ç›´å¼€ç€ï¼Œæœ€å¤š 1 å°æ—¶åæ£€æµ‹åˆ°

---

## ğŸ” éªŒè¯éƒ¨ç½²æˆåŠŸ

### æ£€æŸ¥ GitHub Release

```bash
# æ–¹æ³• 1ï¼šå‘½ä»¤è¡ŒæŸ¥çœ‹
gh release view latest

# æ–¹æ³• 2ï¼šç½‘é¡µæŸ¥çœ‹
# https://github.com/BorderWalker99/figma-plugin-figma_sync/releases
```

ç¡®è®¤ï¼š
- âœ… Tag æ ¼å¼æ­£ç¡®ï¼ˆ`v1.0.1`ï¼Œå¿…é¡»æœ‰ `v`ï¼‰
- âœ… æ ‡è®°ä¸º latest release
- âœ… åŒ…å« 2 ä¸ªæ–‡ä»¶ï¼š
  - `figma-plugin-v1.0.1.zip`
  - `ScreenSync-UserPackage.tar.gz`

### æ£€æŸ¥ Cloud Runï¼ˆå¦‚æœéƒ¨ç½²äº†ï¼‰

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
gcloud run services describe figmasync-test --region asia-east2

# æŸ¥çœ‹æœåŠ¡ URL
gcloud run services describe figmasync-test --region asia-east2 --format 'value(status.url)'

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl https://your-service-url.run.app/health
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 0ï¼šGitHub CLI è®¤è¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
X Failed to log in to github.com account
- The token in default is invalid.
```

**åŸå› **ï¼š
GitHub CLI çš„è®¤è¯ token è¿‡æœŸæˆ–å¤±æ•ˆ

**è§£å†³æ–¹æ³•**ï¼š
```bash
# é‡æ–°ç™»å½• GitHub CLI
gh auth login

# é€‰æ‹©ï¼š
# - GitHub.com
# - HTTPS
# - Login with a web browserï¼ˆæ¨èï¼‰
# æˆ– Paste an authentication token

# éªŒè¯ç™»å½•æˆåŠŸ
gh auth status

# ç°åœ¨å¯ä»¥æ­£å¸¸å‘å¸ƒäº†
./release.sh
```

### é—®é¢˜ 1ï¼šé¦–æ¬¡å‘å¸ƒæ—¶æŠ¥é”™

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ° GUI å®‰è£…å™¨
âŒ æœåŠ¡å™¨æ‰“åŒ…å¤±è´¥
```

**åŸå› **ï¼š
é¦–æ¬¡å‘å¸ƒå‰éœ€è¦å…ˆæ„å»º GUI å®‰è£…å™¨

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ­¥éª¤ 1ï¼šæ„å»º GUI å®‰è£…å™¨ï¼ˆä»…é¦–æ¬¡éœ€è¦ï¼‰
cd installer
npm install
npm run build
cd ..

# æ­¥éª¤ 2ï¼šéªŒè¯æ„å»ºæˆåŠŸ
ls -la installer/dist/mac-arm64/
# åº”è¯¥çœ‹åˆ°ï¼šScreenSync Installer.app

# æ­¥éª¤ 3ï¼šç°åœ¨å¯ä»¥æ­£å¸¸å‘å¸ƒäº†
./release.sh
```

### é—®é¢˜ 2ï¼šæ’ä»¶æ‰“åŒ…å¤±è´¥ï¼Œæ‰¾ä¸åˆ° zip æ–‡ä»¶

**é”™è¯¯ä¿¡æ¯**ï¼š
```
âŒ æ’ä»¶æ‰“åŒ…å¤±è´¥ï¼šæœªæ‰¾åˆ° figma-plugin-v1.0.1.zip
```

**åŸå› **ï¼š
- `package-for-update.sh` æ— æ³•ä» `code.js` è¯»å–ç‰ˆæœ¬å·
- `code.js` ä¸­çš„ç‰ˆæœ¬å·æ ¼å¼ä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ `figma-plugin/code.js` ç¬¬ 3 è¡Œï¼š
```javascript
const PLUGIN_VERSION = '1.0.1';  // ç¡®ä¿æ ¼å¼æ­£ç¡®
```

2. ç¡®ä¿ç‰ˆæœ¬å·ä¸ `VERSION.txt` ä¸€è‡´

3. å•ç‹¬æµ‹è¯•æ‰“åŒ…è„šæœ¬ï¼š
```bash
./package-for-update.sh
# åº”è¯¥ç”Ÿæˆï¼šfigma-plugin-v1.0.1.zip
```

### é—®é¢˜ 3ï¼šç”¨æˆ·æ£€æµ‹ä¸åˆ°æ›´æ–°

**å¯èƒ½åŸå› **ï¼š
- Release æœªæ ‡è®°ä¸º latest
- Tag æ ¼å¼ä¸æ­£ç¡®ï¼ˆç¼ºå°‘ `v`ï¼‰
- æ–‡ä»¶å‘½åé”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. æ£€æŸ¥ Release
gh release view latest

# 2. é‡æ–°å‘å¸ƒ
gh release delete v1.0.1 --yes
./release.sh
```

### é—®é¢˜ 4ï¼šæ›´æ–°ä¸‹è½½å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- æ–‡ä»¶è¿‡å¤§ï¼ˆ>100MBï¼‰
- ç½‘ç»œé—®é¢˜
- GitHub API é™æµ

**è§£å†³æ–¹æ³•**ï¼š
- ç”¨æˆ·é‡è¯•æ›´æ–°
- æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼Œä¼˜åŒ–æ‰“åŒ…
- ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•

### é—®é¢˜ 5ï¼šiPhone å¿«æ·æŒ‡ä»¤ä¸Šä¼ å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- Cloud Run æœåŠ¡æœªæ›´æ–°
- Cloud Run æœåŠ¡å®•æœº

**è§£å†³æ–¹æ³•**ï¼š
```bash
# éƒ¨ç½²åˆ° Cloud Run
./deploy-cloud-run.sh

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
gcloud run services list --region asia-east2
```

### é—®é¢˜ 7ï¼šCloud Run éƒ¨ç½²å¤±è´¥ - npm ci é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
ERROR: failed to build: process "/bin/sh -c npm ci --only=production" did not complete successfully
npm error Cannot find module 'adm-zip'
```

**åŸå› **ï¼š
`package-lock.json` ä¸ `package.json` ä¸åŒæ­¥

**è§£å†³æ–¹æ³•**ï¼š
```bash
# é‡æ–°ç”Ÿæˆ package-lock.json
rm package-lock.json
npm install

# æäº¤æ›´æ–°
git add package-lock.json
git commit -m "fix: update package-lock.json"
git push

# ç°åœ¨å¯ä»¥éƒ¨ç½²äº†
./deploy-cloud-run.sh
```

### é—®é¢˜ 8ï¼šCloud Run å®¹å™¨å¯åŠ¨å¤±è´¥ - "failed to start and listen on port"

**é”™è¯¯ä¿¡æ¯**ï¼š
```
The user-provided container failed to start and listen on the port defined provided by the PORT=8080
âŒ æœªæ•è·çš„å¼‚å¸¸: ReferenceError: ws is not defined at line 2007
```

**åŸå› **ï¼š
`server.js` ä»£ç ç»“æ„é”™è¯¯ï¼Œ`ws.on('error')` åœ¨ `wss.on('connection')` å›è°ƒå¤–é¢

**å·²ä¿®å¤**ï¼š
âœ… å·²ä¿®å¤ä»£ç ç»“æ„ï¼ˆå°† update handlers ç§»åˆ°æ­£ç¡®ä½ç½®ï¼‰
âœ… Docker æ„å»ºæµ‹è¯•é€šè¿‡

**å·²ä¿®å¤**ï¼š
âœ… ä»£ç ç»“æ„å·²ä¿®æ­£
âœ… Docker æ„å»ºæµ‹è¯•é€šè¿‡

**å¦‚æœé‡åˆ°æ­¤é—®é¢˜**ï¼š
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°éƒ¨ç½²
./deploy-cloud-run.sh
```

### é—®é¢˜ 9ï¼šrelease.sh åœ¨æ­¥éª¤ 3 åé€€å‡ºï¼Œæ²¡æœ‰æŠ¥é”™

**ç—‡çŠ¶**ï¼š
```
ğŸ“¤ æ­¥éª¤ 3/5: æäº¤ä»£ç åˆ° GitHub...
   âœ… ä»£ç å·²æäº¤
ï¼ˆç„¶åå°±é€€å‡ºäº†ï¼Œæ²¡æœ‰ç»§ç»­æ­¥éª¤ 4 å’Œ 5ï¼‰
```

**åŸå› **ï¼š
`git push origin main` å¤±è´¥ï¼Œä½†é”™è¯¯è¢« `> /dev/null 2>&1` éšè—äº†

**å¸¸è§å¤±è´¥åŸå› **ï¼š
- è¿œç¨‹ä»“åº“æœ‰æœ¬åœ°æ²¡æœ‰çš„æäº¤
- éœ€è¦å…ˆ pull

**è§£å†³æ–¹æ³•**ï¼š

**æƒ…å†µ 1ï¼šæ²¡æœ‰æœªæäº¤çš„ä¿®æ”¹**
```bash
# ç›´æ¥æ‹‰å–
git pull --rebase origin main

# é‡æ–°è¿è¡Œå‘å¸ƒè„šæœ¬
./release.sh
```

**æƒ…å†µ 2ï¼šæœ‰æœªæäº¤çš„ä¿®æ”¹**
```bash
# å¦‚æœæç¤ºï¼šerror: cannot pull with rebase: You have unstaged changes

# æ–¹æ¡ˆ Aï¼šæäº¤ä¿®æ”¹ï¼ˆæ¨èï¼‰
git add .
git commit -m "fix: your changes description"
git pull --rebase origin main
./release.sh

# æ–¹æ¡ˆ Bï¼šæš‚å­˜ä¿®æ”¹
git stash
git pull --rebase origin main
git stash pop
./release.sh
```

**å·²ä¼˜åŒ–**ï¼š
âœ… `release.sh` ç°åœ¨ä¼šæ˜¾ç¤º git push å¤±è´¥çš„é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 10ï¼šGitHub æ‹’ç»æ¨é€å¤§æ–‡ä»¶

**é”™è¯¯ä¿¡æ¯**ï¼š
```
remote: error: File ScreenSync-UserPackage.tar.gz is 314.18 MB; this exceeds GitHub's file size limit of 100.00 MB
remote: error: GH001: Large files detected.
error: failed to push some refs
```

**åŸå› **ï¼š
æ„å»ºäº§ç‰©ï¼ˆ.tar.gz, .zip, .dmg, installer/dist/ï¼‰è¢«æäº¤åˆ° Git å†å²ä¸­

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ­¥éª¤ 1ï¼šç¡®ä¿ .gitignore å·²æ›´æ–°ï¼ˆå·²å®Œæˆï¼‰

# æ­¥éª¤ 2ï¼šæäº¤æ‰€æœ‰æœªä¿å­˜çš„æ›´æ”¹
git add .
git commit -m "fix: update gitignore"

# æ­¥éª¤ 3ï¼šä» Git å†å²ä¸­åˆ é™¤å¤§æ–‡ä»¶
FILTER_BRANCH_SQUELCH_WARNING=1 git filter-branch --force --index-filter \
  'git rm --cached --ignore-unmatch -r ScreenSync-UserPackage.tar.gz figma-plugin-v*.zip installer/dist/' \
  --prune-empty --tag-name-filter cat -- --all

# æ­¥éª¤ 4ï¼šæ¸…ç†å’Œåƒåœ¾å›æ”¶
rm -rf .git/refs/original/
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# æ­¥éª¤ 5ï¼šå¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹
git push origin main --force
```

**é¢„é˜²æªæ–½**ï¼š
- âœ… `.gitignore` å·²æ›´æ–°ï¼ŒåŒ…å«æ‰€æœ‰æ„å»ºäº§ç‰©
- âœ… æ„å»ºå‰å…ˆ pullï¼Œé¿å…æäº¤å†²çª
- âœ… `release.sh` ä¼šè‡ªåŠ¨æ‰“åŒ…ï¼Œä¸è¦æ‰‹åŠ¨è¿è¡Œæ‰“åŒ…è„šæœ¬

### é—®é¢˜ 11ï¼šç”¨æˆ·ä¸‹è½½åæŠ¥é”™"ScreenSync Installer å·²æŸåï¼Œæ— æ³•æ‰“å¼€"

**ç—‡çŠ¶**ï¼š
ç”¨æˆ·è§£å‹ `ScreenSync-UserPackage.tar.gz` åï¼ŒåŒå‡» `ScreenSync Installer.app` æ˜¾ç¤ºï¼š
```
"ScreenSync Installer"å·²æŸåï¼Œæ— æ³•æ‰“å¼€ã€‚æ‚¨åº”è¯¥å°†å®ƒç§»åˆ°åºŸçº¸ç¯“ã€‚
```

**åŸå› **ï¼š
macOS Gatekeeper å®‰å…¨æœºåˆ¶é˜»æ­¢æœªç­¾åçš„åº”ç”¨è¿è¡Œ

**ç”¨æˆ·ç«¯è§£å†³æ–¹æ³•ï¼ˆ3 ç§æ–¹æ¡ˆï¼‰**ï¼š

**æ–¹æ¡ˆ 1ï¼šåˆ é™¤éš”ç¦»å±æ€§ï¼ˆæ¨èï¼‰**
```bash
# åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼ˆæœ€å®‰å…¨ï¼‰
cd ~/Downloads/ScreenSync-UserPackage
xattr -cr "ScreenSync Installer.app"

# ç„¶ååŒå‡»è¿è¡Œ
```

**æ–¹æ¡ˆ 2ï¼šå³é”®æ‰“å¼€**
```
1. å³é”®ç‚¹å‡» "ScreenSync Installer.app"
2. é€‰æ‹©"æ‰“å¼€"
3. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ç‚¹å‡»"æ‰“å¼€"
4. ï¼ˆé¦–æ¬¡æ‰“å¼€éœ€è¦æ­¤æ“ä½œï¼Œä¹‹åå¯ä»¥ç›´æ¥åŒå‡»ï¼‰
```

**æ–¹æ¡ˆ 3ï¼šç³»ç»Ÿè®¾ç½®å…è®¸**
```
1. åŒå‡»åº”ç”¨ï¼ˆä¼šè¢«é˜»æ­¢ï¼‰
2. æ‰“å¼€"ç³»ç»Ÿè®¾ç½®" â†’ "éšç§ä¸å®‰å…¨æ€§"
3. åœ¨åº•éƒ¨æ‰¾åˆ°"'ScreenSync Installer' å·²è¢«é˜»æ­¢"
4. ç‚¹å‡»"ä»è¦æ‰“å¼€"
```

**å¼€å‘è€…ç«¯é•¿æœŸè§£å†³æ–¹æ¡ˆ**ï¼š

1. **ç”³è¯· Apple Developer Program**ï¼ˆ99 ç¾å…ƒ/å¹´ï¼‰
2. **ç­¾ååº”ç”¨**ï¼š
```bash
# åœ¨ installer/package.json ä¸­æ·»åŠ ç­¾åé…ç½®
"build": {
  "mac": {
    "identity": "Developer ID Application: Your Name (TEAM_ID)",
    "hardenedRuntime": true,
    "gatekeeperAssess": false,
    "entitlements": "entitlements.mac.plist",
    "entitlementsInherit": "entitlements.mac.plist"
  }
}
```

3. **å…¬è¯åº”ç”¨**ï¼ˆNotarizationï¼‰

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆåœ¨ README ä¸­è¯´æ˜ï¼‰**ï¼š
åœ¨ `ScreenSync-UserPackage` ä¸­æ·»åŠ  `å®‰è£…è¯´æ˜.txt`ï¼Œæç¤ºç”¨æˆ·ä½¿ç”¨æ–¹æ¡ˆ 1 æˆ– 2ã€‚

### é—®é¢˜ 12ï¼šå®‰è£…å™¨ä¸­"å®‰è£… Homebrew"æŒ‰é’®ç‚¹å‡»åæ²¡ååº”

**ç—‡çŠ¶**ï¼š
ç”¨æˆ·ç‚¹å‡»"å®‰è£… Homebrew"æŒ‰é’®åï¼Œæ²¡æœ‰ä»»ä½•ååº”ï¼ŒæŒ‰é’®æ˜¾ç¤º"å®‰è£…ä¸­..."ä½†ä¸€ç›´æ²¡æœ‰è¿›å±•

**åŸå› **ï¼š
ä¹‹å‰çš„å®ç°ä½¿ç”¨ `stdio: 'inherit'`ï¼Œä½† Electron GUI åº”ç”¨æ²¡æœ‰å…³è”çš„ç»ˆç«¯ï¼Œå¯¼è‡´ï¼š
- Homebrew å®‰è£…è„šæœ¬éœ€è¦çš„äº¤äº’ï¼ˆè¾“å…¥å¯†ç ã€ç¡®è®¤ï¼‰æ— æ³•æ˜¾ç¤º
- è¿›ç¨‹åœ¨åå°ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼Œä½†ç”¨æˆ·çœ‹ä¸åˆ°ä»»ä½•æç¤º
- çœ‹èµ·æ¥"å¡ä½"æˆ–"æ²¡ååº”"

**å·²ä¿®å¤**ï¼š
âœ… ç°åœ¨ä¼šè‡ªåŠ¨æ‰“å¼€ macOS ç»ˆç«¯åº”ç”¨
âœ… åœ¨ç»ˆç«¯ä¸­è¿è¡Œ Homebrew å®‰è£…è„šæœ¬
âœ… ç”¨æˆ·å¯ä»¥çœ‹åˆ°å®‰è£…è¿›åº¦å’Œæç¤º
âœ… å®‰è£…å®Œæˆåç‚¹å‡»"é‡æ–°æ£€æµ‹"æŒ‰é’®å³å¯ç»§ç»­

**ç”¨æˆ·æ“ä½œæµç¨‹**ï¼š
```
1. ç‚¹å‡»"å®‰è£… Homebrew"æŒ‰é’®
   â†“
2. ç»ˆç«¯åº”ç”¨è‡ªåŠ¨æ‰“å¼€
   â†“
3. åœ¨ç»ˆç«¯ä¸­æŒ‰ç…§æç¤ºï¼š
   - æŒ‰ RETURN ç»§ç»­
   - è¾“å…¥å¯†ç 
   - ç­‰å¾…å®‰è£…å®Œæˆ
   â†“
4. å®‰è£…å®Œæˆåï¼Œè¿”å›å®‰è£…å™¨
   â†“
5. ç‚¹å‡»"é‡æ–°æ£€æµ‹"æŒ‰é’®
   â†“
6. ç»§ç»­å®‰è£…æµç¨‹
```

**å¦‚æœç»ˆç«¯æ²¡æœ‰è‡ªåŠ¨æ‰“å¼€**ï¼š
ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

**è°ƒè¯•æ­¥éª¤**ï¼ˆå¦‚æœå¼€å‘ç¯å¢ƒæµ‹è¯•ï¼‰ï¼š
```bash
# 1. é‡æ–°æ„å»º installerï¼ˆåŒ…å«æœ€æ–°ä¿®å¤ï¼‰
cd installer
npm run build
cd ..

# 2. æµ‹è¯•è¿è¡Œ
# æ‰“å¼€ installer/dist/mac-arm64/ScreenSync Installer.app
# æˆ–è€…å¼€å‘æ¨¡å¼ï¼š
cd installer
npm start

# 3. æ‰“å¼€å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ—¥å¿—
# åœ¨ installer/main.js ä¸­å–æ¶ˆæ³¨é‡Šï¼š
# mainWindow.webContents.openDevTools();
```

### é—®é¢˜ 13ï¼šç‰ˆæœ¬å·ä¸ä¸€è‡´

**å¯èƒ½åŸå› **ï¼š
- æ‰‹åŠ¨ä¿®æ”¹äº†ç‰ˆæœ¬å·ä½†ä¸ä¸€è‡´

**è§£å†³æ–¹æ³•**ï¼š
ç¡®ä¿ä»¥ä¸‹ä½ç½®ç‰ˆæœ¬å·ä¸€è‡´ï¼š
- `figma-plugin/code.js` ç¬¬ 3 è¡Œ
- `VERSION.txt` ç¬¬ 2 è¡Œ
- Git Tag

```bash
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
grep "PLUGIN_VERSION" figma-plugin/code.js
grep "ç‰ˆæœ¬" VERSION.txt
git tag -l | tail -1
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å®šæœŸå‘å¸ƒ

- æ¯å‘¨æˆ–æ¯ä¸¤å‘¨å‘å¸ƒä¸€æ¬¡
- ä¸è¦ç´¯ç§¯å¤ªå¤šæ›´æ”¹
- ç´§æ€¥ Bug å¯ç«‹å³å‘å¸ƒ

### 2. æ¸…æ™°çš„æ›´æ–°è¯´æ˜

```markdown
## æ–°å¢åŠŸèƒ½
- æ·»åŠ  iCloud ç©ºé—´æ£€æµ‹

## Bug ä¿®å¤
- ä¿®å¤ GIF å¯¼å…¥å¤±è´¥é—®é¢˜

## æ€§èƒ½ä¼˜åŒ–
- ä¼˜åŒ–å›¾ç‰‡å¤„ç†é€Ÿåº¦
```

### 3. æµ‹è¯•åå†å‘å¸ƒ

```bash
# 1. æœ¬åœ°æµ‹è¯•
npm start

# 2. Figma ä¸­æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
# 3. ç¡®è®¤æ— è¯¯åå‘å¸ƒ
./release.sh
```

### 4. ç‰ˆæœ¬å·é€’å¢è§„åˆ™

| ä¿®æ”¹ç±»å‹ | ç¤ºä¾‹ | è¯´æ˜ |
|---------|------|------|
| Bug ä¿®å¤ | `1.0.0` â†’ `1.0.1` | ä¿®è®¢å· +1 |
| æ–°å¢åŠŸèƒ½ | `1.0.1` â†’ `1.1.0` | æ¬¡ç‰ˆæœ¬ +1ï¼Œä¿®è®¢å·å½’ 0 |
| é‡å¤§æ›´æ–° | `1.1.0` â†’ `2.0.0` | ä¸»ç‰ˆæœ¬ +1ï¼Œå…¶ä»–å½’ 0 |

---

## ğŸ— æ¶æ„è¯´æ˜ï¼ˆäº†è§£å³å¯ï¼‰

### åŒæœåŠ¡å™¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æœ¬åœ°æœåŠ¡å™¨ï¼ˆç”¨æˆ·ç”µè„‘ï¼‰              â”‚
â”‚                                            â”‚
â”‚  â€¢ WebSocket å®æ—¶é€šä¿¡                      â”‚
â”‚  â€¢ æ–‡ä»¶ç›‘å¬                                â”‚
â”‚  â€¢ å›¾ç‰‡å¤„ç†                                â”‚
â”‚  â€¢ è‡ªåŠ¨æ›´æ–°                                â”‚
â”‚                                            â”‚
â”‚  è¿è¡Œæ–¹å¼ï¼šLaunchAgent è‡ªåŠ¨å¯åŠ¨             â”‚
â”‚  æ›´æ–°æ–¹å¼ï¼šç”¨æˆ·ä¸€é”®æ›´æ–°ï¼ˆè‡ªåŠ¨ï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cloud Run æœåŠ¡å™¨ï¼ˆGoogle Cloudï¼‰       â”‚
â”‚                                            â”‚
â”‚  â€¢ HTTP ä¸Šä¼ ç«¯ç‚¹                           â”‚
â”‚  â€¢ iPhone å¿«æ·æŒ‡ä»¤ä¸Šä¼                      â”‚
â”‚  â€¢ æ— çŠ¶æ€è¯·æ±‚å¤„ç†                          â”‚
â”‚                                            â”‚
â”‚  è¿è¡Œæ–¹å¼ï¼šCloud Run è‡ªåŠ¨ç®¡ç†               â”‚
â”‚  æ›´æ–°æ–¹å¼ï¼šå¼€å‘è€…æ‰‹åŠ¨éƒ¨ç½²                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªæœåŠ¡å™¨ï¼Ÿ**

1. **æœ¬åœ°æœåŠ¡å™¨**ï¼šå¤„ç†éœ€è¦æŒä¹…è¿æ¥çš„åŠŸèƒ½ï¼ˆWebSocketã€æ–‡ä»¶ç›‘å¬ï¼‰
2. **Cloud Run**ï¼šå¤„ç†æ— çŠ¶æ€çš„ HTTP è¯·æ±‚ï¼ˆiPhone ä¸Šä¼ ï¼‰

**99% çš„ä»£ç åœ¨æœ¬åœ°æœåŠ¡å™¨ï¼Œåªæœ‰ HTTP ä¸Šä¼ ç«¯ç‚¹åœ¨ Cloud Runã€‚**

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

### å¿«é€Ÿæ£€æŸ¥æ¸…å•

- [ ] ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Ÿ
- [ ] Release æ˜¯å¦å‘å¸ƒæˆåŠŸï¼Ÿ
- [ ] æ–‡ä»¶æ˜¯å¦éƒ½ä¸Šä¼ äº†ï¼Ÿ
- [ ] Tag æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Ÿ
- [ ] æ˜¯å¦æ ‡è®°ä¸º latestï¼Ÿ

### æ‰‹åŠ¨æ“ä½œï¼ˆä¸æ¨èï¼‰

å¦‚æœ `release.sh` å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨æ“ä½œï¼š

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·
vim figma-plugin/code.js  # ä¿®æ”¹ç¬¬ 3 è¡Œ
vim VERSION.txt            # ä¿®æ”¹ç¬¬ 2 è¡Œ

# 2. æ‰“åŒ…
./package-for-update.sh
./package-for-distribution.sh

# 3. æäº¤ä»£ç 
git add .
git commit -m "chore: release v1.0.1"
git push

# 4. åˆ›å»º Release
git tag v1.0.1
git push --tags
gh release create v1.0.1 \
  --title "v1.0.1" \
  --notes "æ›´æ–°è¯´æ˜" \
  --latest \
  figma-plugin-v1.0.1.zip \
  ScreenSync-UserPackage.tar.gz
```

---

## ğŸ”§ è„šæœ¬è¯´æ˜

é¡¹ç›®åŒ…å«ä»¥ä¸‹éƒ¨ç½²è„šæœ¬ï¼Œ**éƒ½å¿…é¡»ä¿ç•™**ï¼š

| è„šæœ¬æ–‡ä»¶ | ä½œç”¨ | ä½•æ—¶ä½¿ç”¨ | æ˜¯å¦å¿…éœ€ |
|---------|------|---------|---------|
| `release.sh` | ä¸€é”®å‘å¸ƒï¼ˆè°ƒç”¨ä¸‹é¢ä¸¤ä¸ªè„šæœ¬ï¼‰ | æ¯æ¬¡å‘å¸ƒ | âœ… å¿…éœ€ |
| `package-for-update.sh` | æ‰“åŒ…æ’ä»¶ â†’ `figma-plugin-v*.zip` | è¢« release.sh è°ƒç”¨ | âœ… å¿…éœ€ |
| `package-for-distribution.sh` | æ‰“åŒ…æœåŠ¡å™¨ â†’ `ScreenSync-UserPackage.tar.gz` | è¢« release.sh è°ƒç”¨ | âœ… å¿…éœ€ |
| `deploy-cloud-run.sh` | éƒ¨ç½²åˆ° Google Cloud Run | ä»…ä¿®æ”¹ HTTP ä¸Šä¼ ç«¯ç‚¹æ—¶ | âš ï¸ ç‰¹æ®Šæƒ…å†µ |

**ä¾èµ–å…³ç³»**ï¼š
```
release.sh
    â”œâ”€ package-for-update.shï¼ˆæ‰“åŒ…æ’ä»¶ï¼‰
    â””â”€ package-for-distribution.shï¼ˆæ‰“åŒ…æœåŠ¡å™¨ï¼‰

deploy-cloud-run.shï¼ˆç‹¬ç«‹ä½¿ç”¨ï¼‰
```

**é‡è¦**ï¼šä¸è¦åˆ é™¤å‰ä¸‰ä¸ªè„šæœ¬ï¼Œå¦åˆ™ `release.sh` æ— æ³•æ­£å¸¸å·¥ä½œï¼

---

## âœ… æ€»ç»“

### è®°ä½è¿™ä¸‰ç‚¹

1. **99% çš„æƒ…å†µ**ï¼šåªéœ€è¿è¡Œ `./release.sh`
2. **ä¿®æ”¹æ–‡ä»¶**ï¼šçœ‹æ–‡ä»¶ååˆ¤æ–­æ˜¯å¦éœ€è¦ Cloud Run
3. **ä¸ç¡®å®šæ—¶**ï¼šå…ˆåªè¿è¡Œ `./release.sh`ï¼Œè§‚å¯Ÿåé¦ˆ

### æ ¸å¿ƒå‘½ä»¤

```bash
# å¸¸è§„éƒ¨ç½²ï¼ˆ99%ï¼‰
./release.sh

# Cloud Run éƒ¨ç½²ï¼ˆ1%ï¼‰
./release.sh && ./deploy-cloud-run.sh
```

### å¿…éœ€çš„è„šæœ¬æ–‡ä»¶

```bash
# è¿™ä¸‰ä¸ªè„šæœ¬å¿…é¡»ä¿ç•™ï¼Œä¸è¦åˆ é™¤ï¼
release.sh                    # ä¸»è„šæœ¬
package-for-update.sh         # ä¾èµ–ï¼šæ‰“åŒ…æ’ä»¶
package-for-distribution.sh   # ä¾èµ–ï¼šæ‰“åŒ…æœåŠ¡å™¨

# è¿™ä¸ªè„šæœ¬ä»…ç‰¹æ®Šæƒ…å†µä½¿ç”¨
deploy-cloud-run.sh          # Cloud Run éƒ¨ç½²
```

**å°±è¿™ä¹ˆç®€å•ï¼** ğŸ‰

